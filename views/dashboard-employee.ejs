<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('partials/head'); %>
    <title>Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet" />
  </head>

  <body class="dark-theme">
    <%- include('partials/navbar'); %>

    <div class="container py-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-gradient">Employee Dashboard</h2>
        <button class="btn btn-outline-light" id="themeToggle">ðŸŒ“</button>
      </div>

      <div class="card glass-card p-4 text-center">
        <h4>Welcome, <%= user.name %> ðŸ‘‹</h4>
        <p class="">You can view and manage your assigned tasks here.</p>
        <a href="/tasks" class="btn btn-primary mt-3">View My Tasks</a>
      </div>
    </div>
    <div class="container my-5">
      <h3 class="text-center mb-4">ðŸ“Š Task Analytics</h3>
      <div class="row">
        <div class="col-md-6">
          <canvas id="statusChart"></canvas>
        </div>
        <div class="col-md-6">
          <canvas id="weeklyChart"></canvas>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/dashboard.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Data passed from backend
      const taskData = <%- JSON.stringify(tasks) %>;

      // ðŸŸ© 1. Task Status Pie Chart
      const statusCounts = { Pending: 0, 'In Progress': 0, Review: 0, Completed: 0 };
      taskData.forEach(t => statusCounts[t.status]++);

      new Chart(document.getElementById('statusChart'), {
        type: 'pie',
        data: {
          labels: Object.keys(statusCounts),
          datasets: [{
            data: Object.values(statusCounts),
            backgroundColor: ['#f87171', '#fbbf24', '#60a5fa', '#4ade80']
          }]
        },
        options: {
          plugins: { title: { display: true, text: 'Task Distribution by Status' } }
        }
      });

      // ðŸ“… 2. Weekly Productivity (Tasks Completed per Day)
      const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      const productivity = Array(7).fill(0);
      taskData.forEach(t => {
        if (t.completedAt) {
          const day = new Date(t.completedAt).getDay();
          productivity[day]++;
        }
      });

      new Chart(document.getElementById('weeklyChart'), {
        type: 'bar',
        data: {
          labels: weekDays,
          datasets: [{
            label: 'Tasks Completed',
            data: productivity,
            backgroundColor: '#00b4d8'
          }]
        },
        options: {
          scales: { y: { beginAtZero: true } },
          plugins: { title: { display: true, text: 'Weekly Productivity' } }
        }
      });
    </script>
  </body>
</html>
